(function(){angular.module("formEditorApp",["builder","builder.components","validator.rules","ngAnimate","ngRoute","ngSanitize","ui.bootstrap","restangular","config"]).config(["$routeProvider","RestangularProvider","ENV",function(a,b,c){b.setBaseUrl(c.REST_URL),b.setDefaultHeaders({"Content-Type":"application/json"}),a.when("/",{templateUrl:"views/main.html"}).otherwise({redirectTo:"/"})}])}).call(this),angular.module("config",[]).constant("ENV",{REST_URL:"/rest/v2"}),function(){angular.module("builder",["builder.directive"])}.call(this),function(){function a(){return"comp"+ ++c}var b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},c=0;angular.module("builder.provider",[]).provider("$builder",function(){var c,d,e;d=null,c=null,e=null,this.config={popoverPlacement:"right"},this.components={},this.groups=[],this.broadcastChannel={updateInput:"$updateInput"},this.forms={"default":[]},this.getFieldGroup=function(a,b){var c,d=this.forms[a];return angular.forEach(d,function(a){a.id===b?c=a:"formFieldTabGroup"===a.component&&angular.forEach(a.webFormFieldTabs,function(a){angular.forEach(a.formFields,function(a){a.id===b&&(c=a)})})}),c},this.removeObject=function f(a,b){angular.forEach(a,function(c){if(c.id===b){var d=a.indexOf(c);a.splice(d,1)}else"formFieldTabGroup"===c.component?angular.forEach(c.webFormFieldTabs,function(a){f(a.formFields,b)}):"formFieldGroup"===c.component&&f(c.formFields,b)})},this.convertComponent=function(a,b){var c,d,e,f,g;return c={name:a,group:null!=(d=b.group)?d:"Default",editable:null!=(e=b.editable)?e:!0,labels:null!=(f=b.labels)?f:null,model:null!=(g=b.model)?g:null,template:b.template,templateUrl:b.templateUrl,formTemplateUrl:b.formTemplateUrl,popoverTemplate:b.popoverTemplate,popoverTemplateUrl:b.popoverTemplateUrl},c.template||c.templateUrl||console.error("The template is empty."),c},this.convertFormObject=function(a){var b,c,d;if(null==a&&(a={}),b=this.components[a.component],null==b)throw"The component "+a.component+" was not registered.";var e;return e="formFieldTab"===a.component?angular.copy(a.labels):angular.copy(b.labels),c={id:a.id,component:a.component,editable:null!=(d=a.editable)?d:b.editable,labels:e,model:angular.copy(b.model)},"formFieldGroup"===a.component&&(c.formFields=[]),c},this.reindexFormObject=function(a){return function(b){var c,d,e,f;for(c=a.forms[b],d=e=0,f=c.length;f>e;d=e+=1)c[d].index=d}}(this),this.setupProviders=function(a){return function(a){return d=a,c=d.get("$http"),e=d.get("$templateCache")}}(this),this.loadTemplate=function(a){return null==a.template&&c.get(a.templateUrl,{cache:e}).success(function(b){return a.template=b}),void 0!==a.formTemplateUrl&&c.get(a.formTemplateUrl,{cache:e}).success(function(b){return a.formTemplate=b}),void 0!==a.popoverTemplateUrl?c.get(a.popoverTemplateUrl,{cache:e}).success(function(b){return a.popoverTemplate=b}):void 0},this.registerComponent=function(a){return function(c,e){var f,g;null==e&&(e={}),null==a.components[c]&&(f=a.convertComponent(c,e),a.components[c]=f,null!=d&&a.loadTemplate(f),g=f.group,b.call(a.groups,g)<0&&a.groups.push(f.group))}}(this),this.addFormObject=function(a){return function(b,c){var d;return null==c&&(c={}),null==(d=a.forms)[b]&&(d[b]=[]),a.insertFormObject(b,a.forms[b].length,c)}}(this),this.insertFormObject=function(b){return function(c,d,e){var f;return null==e&&(e={}),e.id=a(),null==(f=b.forms)[c]&&(f[c]=[]),d>b.forms[c].length?d=b.forms[c].length:0>d&&(d=0),b.forms[c].splice(d,0,b.convertFormObject(e)),b.reindexFormObject(c),b.forms[c][d]}}(this),this.insertTabObject=function(b){return function(c,d){var e;angular.forEach(b.forms[c],function(a){a.id===d&&(e=a)}),void 0===e.webFormFieldTabs&&(e.webFormFieldTabs=[]);var f={component:"formFieldTab",id:a(),labels:{name:"Tab "+(e.webFormFieldTabs.length+1)}};return e.webFormFieldTabs.push(b.convertFormObject(f)),e.webFormFieldTabs}}(this),this.insertTabFieldObject=function(b){return function(c,d,e){var f;angular.forEach(b.forms["default"],function(a){a.id===d&&(f=a)});var g;return angular.forEach(f.webFormFieldTabs,function(a){a.id===c&&(g=a)}),void 0===g.formFields&&(g.formFields=[]),e.id=a(),g.formFields.push(b.convertFormObject(e)),g.formFields}}(this),this.insertFieldGroupObject=function(b){return function(c,d){null==c&&(c={});var e=b.getFieldGroup("default",d);return c.id=a(),e.formFields.push(b.convertFormObject(c)),e.formFields}}(this),this.removeFormObject=function(a){return function(b,c){this.removeObject(a.forms[b],c)}}(this),this.removeDraggedObject=function(a){return function(b,c){var d;return d=a.forms[b],d.splice(c,1),a.reindexFormObject(b)}}(this),this.removeTabObject=function(a){return function(a,b){b.formFields=[];var c=a.indexOf(b);a.splice(c,1)}}(this),this.updateFormObjectIndex=function(a){return function(b,c,d){var e,f;if(c!==d)return f=a.forms[b],e=f.splice(c,1)[0],f.splice(d,0,e),a.reindexFormObject(b)}}(this),this.$get=["$injector",function(a){return function(b){var c,d,e;a.setupProviders(b),e=a.components;for(d in e)c=e[d],a.loadTemplate(c);return{config:a.config,components:a.components,groups:a.groups,forms:a.forms,broadcastChannel:a.broadcastChannel,registerComponent:a.registerComponent,addFormObject:a.addFormObject,insertFormObject:a.insertFormObject,insertTabObject:a.insertTabObject,insertTabFieldObject:a.insertTabFieldObject,insertFieldGroupObject:a.insertFieldGroupObject,removeFormObject:a.removeFormObject,removeTabObject:a.removeTabObject,removeDraggedObject:a.removeDraggedObject,updateFormObjectIndex:a.updateFormObjectIndex,getFieldGroup:a.getFieldGroup,removeObject:a.removeObject}}}(this)]})}.call(this),function(){angular.module("builder.drag",[]).provider("$drag",function(){var a,b,c;a=null,b=null,this.data={draggables:{},droppables:{}},this.mouseMoved=!1,this.isMouseMoved=function(a){return function(){return b.$broadcast("CLEAR_VALIDATION"),a.mouseMoved}}(this),this.hooks={down:{},move:{},up:{}},this.eventMouseMove=function(){},this.eventMouseUp=function(){},$(function(a){return function(){return $(document).on("mousedown",function(b){var c,d,e;a.mouseMoved=!1,e=a.hooks.down;for(d in e)(c=e[d])(b)}),$(document).on("mousemove",function(b){var c,d,e;a.mouseMoved=!0,e=a.hooks.move;for(d in e)(c=e[d])(b)}),$(document).on("mouseup",function(b){var c,d,e;e=a.hooks.up;for(d in e)(c=e[d])(b)})}}(this)),this.currentId=0,this.getNewId=function(a){return function(){return""+a.currentId++}}(this),this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}})},this.setupProviders=function(c){return a=c,b=a.get("$rootScope")},this.isHover=function(a){return function(a,b){var c,d,e,f,g;return d=a.offset(),e=b.offset(),f={width:a.width(),height:a.height()-20},g={width:b.width(),height:b.outerHeight()-20},c={x:!1,y:!1},c.x=d.left>e.left&&d.left<e.left+g.width,c.x=c.x||d.left+f.width>e.left&&d.left+f.width<e.left+g.width,c?(c.y=d.top>e.top&&d.top<e.top+g.height,c.y=c.y||d.top+f.height>e.top&&d.top+f.height<e.top+g.height,c.x&&c.y):!1}}(this),c=function(a,b){return setTimeout(function(){return b()},a)},this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(a){return function(){return a.autoScroll.scrolling=!0,a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1}}(this),start:function(a){return function(b){if(b.clientY<50){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else{if(!(b.clientY>$(window).innerHeight()-50))return a.autoScroll.up=!1,a.autoScroll.down=!1;if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}}}(this),stop:function(a){return function(){return a.autoScroll.up=!1,a.autoScroll.down=!1}}(this)},this.dragMirrorMode=function(a){return function(b,c,d){var e;return null==c&&(c=!0),e={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:d},b.on("mousedown",function(d){var f;return d.preventDefault(),f=b.clone(),e.element=f[0],f.addClass("fb-draggable form-horizontal prepare-dragging"),a.hooks.move.drag=function(c,d){var g,h,i,j;if(!f.hasClass("prepare-dragging")||(f.css({width:b.width(),height:b.height()}),f.removeClass("prepare-dragging"),f.addClass("dragging"),!d)){f.offset({left:c.pageX-f.width()/2,top:c.pageY-f.height()/2}),a.autoScroll.start(c),i=a.data.droppables,j=[];for(h in i)g=i[h],a.isHover(f,$(g.element))?j.push(g.move(c,e)):j.push(g.out(c,e));return j}},a.hooks.up.drag=function(b){var c,d,g,h;h=a.data.droppables;for(d in h)c=h[d],g=a.isHover(f,$(c.element)),c.up(b,g,e);return delete a.hooks.move.drag,delete a.hooks.up.drag,e.element=null,f.remove(),a.autoScroll.stop()},$("body").append(f),c?void 0:a.hooks.move.drag(d,c)}),e}}(this),this.dragDragMode=function(a){return function(b,c,d){var e;return null==c&&(c=!0),e={id:a.getNewId(),mode:"drag",maternal:null,element:b[0],object:d},b.addClass("fb-draggable"),b.on("mousedown",function(d){return d.preventDefault(),b.hasClass("dragging")?void 0:(b.addClass("prepare-dragging"),a.hooks.move.drag=function(c,d){var f,g,h;if(!b.hasClass("prepare-dragging")||(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),!d)){b.offset({left:c.pageX-b.width()/2,top:c.pageY-b.height()/2}),a.autoScroll.start(c),h=a.data.droppables;for(g in h)f=h[g],a.isHover(b,$(f.element))?f.move(c,e):f.out(c,e)}},a.hooks.up.drag=function(c){var d,f,g,h;h=a.data.droppables;for(f in h)d=h[f],g=a.isHover(b,$(d.element)),d.up(c,g,e);return delete a.hooks.move.drag,delete a.hooks.up.drag,b.css({width:"",height:"",left:"",top:""}),b.removeClass("dragging defer-dragging"),a.autoScroll.stop()},c?void 0:a.hooks.move.drag(d,c))}),e}}(this),this.dropMode=function(a){return function(c,d){var e;return e={id:a.getNewId(),element:c[0],move:function(a,c){return b.$apply(function(){return"function"==typeof d.move?d.move(a,c):void 0})},up:function(a,c,e){return b.$apply(function(){return"function"==typeof d.up?d.up(a,c,e):void 0})},out:function(a,c){return b.$apply(function(){return"function"==typeof d.out?d.out(a,c):void 0})}}}}(this),this.draggable=function(a){return function(b,c){var d,e,f,g,h,i,j;if(null==c&&(c={}),f=[],"mirror"===c.mode)for(g=0,i=b.length;i>g;g++)e=b[g],d=a.dragMirrorMode($(e),c.defer,c.object),f.push(d.id),a.data.draggables[d.id]=d;else for(h=0,j=b.length;j>h;h++)e=b[h],d=a.dragDragMode($(e),c.defer,c.object),f.push(d.id),a.data.draggables[d.id]=d;return f}}(this),this.droppable=function(a){return function(b,c){var d,e,f,g,h;for(null==c&&(c={}),f=[],g=0,h=b.length;h>g;g++)e=b[g],d=a.dropMode($(e),c),f.push(d),a.data.droppables[d.id]=d;return f}}(this),this.get=function(a){return this.setupEasing(),this.setupProviders(a),{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this),function(){var a;a=function(a,b){var c=angular.copy(a);delete c.$$hashKey,angular.extend(b,c)},angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(b,c){var d;return d=c.get("$builder"),b.setupScope=function(c){var e;return a(c,b),b.model=void 0!==c.model?c.model:{},b.$watch("model",function(a){return c.model=a,c.validation=b.validation},!0),e=d.components[c.component],b.validationOptions=e.validationOptions},b.data={model:null,labels:null,backup:function(){this.model=angular.copy(b.formObject.model),this.labels=angular.copy(b.formObject.labels)}}}]).controller("fbComponentsController",["$scope","$injector",function(a,b){var c;return c=b.get("$builder"),a.selectGroup=function(b,d){var e,f,g,h;null!=b&&b.preventDefault(),a.activeGroup=d,a.components=[],g=c.components,h=[];for(f in g)e=g[f],e.group===d&&h.push(a.components.push(e));return h},a.groups=c.groups,a.activeGroup=a.groups[0],a.allComponents=c.components,a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})}]).controller("fbComponentController",["$scope",function(b){return b.copyObjectToScope=function(c){return a(c,b)}}]).controller("FormBuilderController",["$scope","$builder","$validator",function(a,b){a.form=b.forms["default"]}])}.call(this),function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]).directive("fbBuilder",["$injector",function(a){var b,c,d,e,f;return b=a.get("$builder"),c=a.get("$drag"),d=a.get("$log"),e=a.get("$rootScope"),f=a.get("$commons"),{restrict:"A",scope:{fbBuilder:"="},templateUrl:"templates/builder/builder-template.html",link:function(a,d,g){var h,i,j,k=!1;return a.formName=g.fbBuilder,null==(i=b.forms)[j=a.formName]&&(i[j]=[]),a.formObjects=b.forms[a.formName],h=!0,a.$on("START_INTERRUPT",function(){$(d).find(".empty").remove(),k=!0}),a.$on("END_INTERRUPT",function(a){"fbBuilder"!==a&&(k=!1)}),$(d).addClass("fb-builder"),c.droppable($(d),{move:function(a,b){k||"formFieldTab"===b.object.componentName||f.move(h,d,event)},out:function(){f.out(h,d)},up:function(f,i,j){var l;return h=!0,c.isMouseMoved()?(i||"drag"!==j.mode?i&&(k||"mirror"!==j.mode||"formFieldTab"===j.object.componentName||(b.addFormObject(a.formName,{component:j.object.componentName}),e.$broadcast("END_INTERRUPT","fbBuilder"))):(l=j.object.formObject,l.editable&&(b.removeDraggedObject(g.fbBuilder,l.index),k=!1)),void $(d).find(".empty").remove()):void $(d).find(".empty").remove()}})}}}])}.call(this),function(){angular.module("builder.directive").directive("fbFormObjectEditable",["$injector",function(a){var b,c,d,e,f,g;return b=a.get("$builder"),d=a.get("$drag"),c=a.get("$compile"),e=a.get("$validator"),f=a.get("$log"),g=a.get("$rootScope"),{restrict:"A",controller:"fbFormObjectEditableController",scope:{formObject:"=fbFormObjectEditable"},link:function(a,f){var h;if(a.inputArray=[],a.$component=b.components[a.formObject.component],a.setupScope(a.formObject),"formFieldTabGroup"===a.component){var i=c(a.$component.formTemplate)(a);i[0].id=a.formObject.id,$(f).html(i)}else"formFieldTab"!==a.component&&a.$watch("$component.template",function(b){var d;b&&(d=c(b)(a),d[0].id=a.formObject.id,$(f).html(d))});$(f).on("click",function(){return!1}),d.draggable($(f),{object:{formObject:a.formObject}}),a.formObject.editable&&(h={},a.$component.popoverTemplate&&($(f).removeClass(h.id),h={id:"fb-"+Math.random().toString().substr(2),isClickedSave:!1,view:null,html:a.$component.popoverTemplate},h.html=$(h.html).addClass(h.id),h.view=c(h.html)(a),$(f).addClass(h.id),$(f).popover({html:!0,title:a.$component.label,content:h.view,container:"body",placement:b.config.popoverPlacement})),a.popover={save:function(b){b.preventDefault(),e.validate(a).success(function(){return h.isClickedSave=!0,$(f).popover("hide")})},remove:function(c){c.preventDefault(),"formFieldTab"===a.component?(b.removeTabObject(a.$parent.formFieldTabs,a.formObject),g.$broadcast("TAB_REMOVE",a.$parent.formFieldTabs)):b.removeFormObject("default",a.formObject.id),$(f).popover("hide")},shown:function(){return a.data.backup(),h.isClickedSave=!1},cancel:function(b){b&&(a.model=angular.copy(a.data.model),"formFieldTab"!==a.component?a.labels=angular.copy(a.data.labels):a.formObject.labels=angular.copy(a.data.labels),e.reset(a,"model"),b.preventDefault(),$(f).popover("hide"),$('.popover[style*="display: block"]').css("display","none"))}},$(f).on("shown.bs.popover",function(){$(".popover ."+h.id+" input:first").select(),a.$apply(function(){return a.popover.shown()})}),a.$watch("model.name.values.en",function(b){void 0!==b&&""!==b&&("formFieldTab"===a.component?a.formObject.labels.name=b:a.labels.name=b)}),a.$watch("model.tooltip.values.en",function(b){void 0!==b&&""!==b&&(a.labels.tooltip=b)}),a.$watch("model.emptyText.values.en",function(b){void 0!==b&&""!==b&&(a.labels.emptyText=b)}),$(f).on("hide.bs.popover",function(){var b=$("form."+h.id).closest(".popover");return h.isClickedSave||(a.$$phase||a.$root.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()})),b.removeClass("in"),setTimeout(function(){return b.hide()},300),!1}))}}}])}.call(this),function(){angular.module("builder.directive").directive("fbComponents",function(){return{restrict:"A",templateUrl:"templates/component/components-template.html",controller:"fbComponentsController"}})}.call(this),function(){angular.module("builder.directive").directive("fbComponent",["$injector",function(a){var b,c,d;return b=a.get("$builder"),d=a.get("$drag"),c=a.get("$compile"),{restrict:"A",scope:{component:"=fbComponent"},controller:"fbComponentController",link:function(a,b){return a.copyObjectToScope(a.component),d.draggable($(b),{mode:"mirror",defer:!1,object:{componentName:a.component.name}}),a.$watch("component.template",function(d){var e;d&&(e=c(d)(a),$(b).html(e))})}}}])}.call(this),function(){angular.module("builder.directive").factory("$commons",function(){function a(a,b,d){var e,f,g,h,i,j,k,l,m,n,o;if(a&&$("div.fb-form-object-editable").popover("hide"),g=$(b).find(".fb-form-object-editable:not(.empty,.dragging)"),0===g.length)return void(0===$(b).find(".fb-form-object-editable.empty").length&&$(b).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>")));for(k=[],k.push(-1e3),i=l=0,n=g.length;n>l;i=l+=1)f=$(g[i]),j=f.offset(),h=f.height(),k.push(j.top+h/2);for(k.push(k[k.length-1]+1e3),i=m=1,o=k.length;o>m;i=m+=1)if(d.pageY>k[i-1]&&d.pageY<=k[i]){c(b),e=$("<div class='fb-form-object-editable empty'></div>"),i-1<g.length?e.insertBefore($(g[i-1])):e.insertAfter($(g[i-2]));break}}function b(a,b){a&&$("div.fb-form-object-editable").popover("hide"),c(b)}function c(a){$(a).find(".empty").remove()}return{move:a,out:b,removePlaceHolder:c}})}.call(this),function(){angular.module("builder.directive").directive("formFieldTabGroup",["$injector",function(a){var b,c,d,e,f;return b=a.get("$builder"),c=a.get("$drag"),d=a.get("$rootScope"),e=a.get("$log"),f=a.get("$commons"),{restrict:"A",templateUrl:"templates/component/tab-group/tab-group-template.html",controller:"tabGroupController",link:function(a,e){var g=function(){var b=a.formFieldTabs.length-1;a.activeTab=a.formFieldTabs[b]};a.formFieldTabs=b.insertTabObject("default",$(e)[0].id),g();var h=!0;return c.droppable($(e),{move:function(a,b){if("formFieldTab"===b.object.componentName){d.$broadcast("START_INTERRUPT","formFieldTabGroup");var c=$("<div class='fb-form-object-editable empty'></div>");$(e).find("#empty").append(c)}},out:function(){f.out(h,e)},up:function(c,i,j){h=!0,i&&"mirror"===j.mode&&"formFieldTab"===j.object.componentName&&(a.formFieldTabs=b.insertTabObject("default",$(e)[0].id),g()),d.$broadcast("END_INTERRUPT","formFieldTabGroup"),f.removePlaceHolder(e)}})}}}])}.call(this),function(){angular.module("builder.directive").controller("tabGroupController",["$injector","$scope",function(a,b){a.get("$timeout");b.selectTab=function(a,c){b.$broadcast("TAB_SWITCH"),b.activeTab=c},b.$on("TAB_REMOVE",function(a,c){c.length>0&&(b.activeTab=c[0])})}])}.call(this),function(){angular.module("builder.directive").directive("formFieldTab",["$injector",function(a){var b,c,d,e,f,g;return b=a.get("$builder"),c=a.get("$drag"),d=a.get("$rootScope"),e=a.get("$compile"),f=a.get("$log"),g=a.get("$commons"),{restrict:"A",link:function(a,f,h){var i=!1;h.id=a.id,a.$on("START_INTERRUPT",function(a,b){"formFieldTab"!==b&&(g.removePlaceHolder(f),i=!0)}),a.$on("TAB_SWITCH",function(){$("div.fb-form-object-editable").popover("hide")}),a.$on("END_INTERRUPT",function(a,b){"formFieldTab"!==b&&"formFieldGroup"!==b&&(i=!1)}),a.tabFormFieldObjects=[],a.$watch("activeTab",function(b){$('.popover[style*="display: block"]').css("display","none");var c=['<div fb-form-object-editable="activeTab" class="fb-tab"  id="'+a.activeTab.id+'">','<div class="fb-form-object-editable" ng-repeat="formField in tabFormFieldObjects"','fb-form-object-editable="formField"></div>',"</div>"].join(""),d=e(c)(a);$(f).html(d),void 0!==b.formFields?a.tabFormFieldObjects=b.formFields:a.tabFormFieldObjects=[]}),a.$watch("activeTab.formFields",function(b){a.tabFormFieldObjects=b});var j=!0;return c.droppable($(f),{move:function(a,b){"formFieldTab"!==b.object.componentName&&"formFieldTabGroup"!==b.object.componentName&&(d.$broadcast("START_INTERRUPT","formFieldTab"),g.move(j,f,a))},out:function(){g.out(j,f)},up:function(e,h,k){return j=!0,c.isMouseMoved()?(h&&(i||"mirror"!==k.mode||"formFieldTab"===k.object.componentName||"formFieldTabGroup"===k.object.componentName||(a.tabFormFieldObjects=b.insertTabFieldObject(a.activeTab.id,a.formObject.id,{component:k.object.componentName}),d.$broadcast("END_INTERRUPT","formFieldTab"))),void g.removePlaceHolder(f)):void g.removePlaceHolder(f)}})}}}])}.call(this),function(){angular.module("builder.directive").directive("formFieldGroup",["$injector",function(a){var b,c,d,e;return b=a.get("$builder"),c=a.get("$drag"),d=a.get("$rootScope"),e=a.get("$commons"),{restrict:"A",templateUrl:"templates/component/field-group/field-group-template.html",link:function(a,f){var g,h=b.getFieldGroup("default",$(f)[0].parentElement.id);return void 0!==h?a.formFieldObjects=h.formFields:a.formFieldObjects=[],g=!0,$(f).addClass("fb-field-group"),c.droppable($(f),{move:function(a,b){"formFieldGroup"!==b.object.componentName&&"formFieldTab"!==b.object.componentName&&(d.$broadcast("START_INTERRUPT","formFieldGroup"),e.move(g,f,a))},out:function(){e.out(g,f)},up:function(h,i,j){return g=!0,c.isMouseMoved()?(i&&"mirror"===j.mode&&"formFieldGroup"!==j.object.componentName&&"formFieldTab"!==j.object.componentName&&"formFieldTabGroup"!==j.object.componentName&&(a.formFieldObjects=b.insertFieldGroupObject({component:j.object.componentName},$(f)[0].parentElement.id)),d.$broadcast("END_INTERRUPT","formFieldGroup"),void e.removePlaceHolder(f)):void e.removePlaceHolder(f)}})}}}])}.call(this),function(){angular.module("builder.components",["builder","validator.rules"]).config(["$builderProvider",function(a){a.registerComponent("formMediaDataField",{group:"Field",labels:{name:"MediaData title",tooltip:"Tooltip text",emptyText:"Placeholder text"},model:{mediaMetadata:{},disabled:!1,readOnly:!1,required:!1,$type:"WebFormMediaMetadataField"},templateUrl:"templates/form/form-mediadata-field/template.html",popoverTemplateUrl:"templates/form/form-mediadata-field/edit-template.html"}),a.registerComponent("formFileField",{group:"Field",labels:{name:"File(s)",tooltip:"The file(s) to submit"},model:{multiple:!1,disabled:!1,readOnly:!1,required:!1,$type:"WebFormFileField"},templateUrl:"templates/form/form-file-field/template.html",popoverTemplateUrl:"templates/form/form-file-field/edit-template.html"}),a.registerComponent("formFieldTabGroup",{group:"Group",templateUrl:"templates/form/form-field-tab-group/template.html",formTemplateUrl:"templates/form/form-field-tab-group/form-template.html"}),a.registerComponent("formFieldTab",{group:"Group",labels:{name:"Tab"},model:{formFields:[],disabled:!1,readOnly:!1,required:!1,$type:"WebFormFieldTab"},templateUrl:"templates/form/form-field-tab/template.html",popoverTemplateUrl:"templates/form/form-field-tab/edit-template.html"}),a.registerComponent("formFieldGroup",{group:"Group",labels:{name:"Field Group"},model:{formFields:[],disabled:!1,readOnly:!1,required:!1,$type:"WebFormFieldGroup"},templateUrl:"templates/form/form-field-group/template.html",popoverTemplateUrl:"templates/form/form-field-group/edit-template.html"})}])}.call(this),function(){angular.module("builder").directive("fbJsonViewer",["$injector",function(a){var b=a.get("$builder"),c=a.get("ModelConverter"),d=a.get("ModelValidator"),e=a.get("$log");return{restrict:"A",templateUrl:"templates/model/fb-json-viewer.html",link:function(a){a.form=b.forms["default"],a.validationError=!1;var f={data:[]};a.$on("CLEAR_VALIDATION",function(){i()}),a.$watch("form",function(b){f.data=c.convert(b,[]),a.jsonForm=angular.toJson(f,!0)},!0),a.postForm=function(){i();var b=d.validate(a.form);b.valid||(a.validationError=!0,angular.forEach(b.errors,function(a){var b=g(a);e.debug(JSON.stringify(a.message)),void 0!==b&&h(b)}))};var g=function(b){for(var c,d=b.dataPath,e=d.split("/"),f=a.form,g=1;g<e.length-1;g++)f=f[e[g]],f.hasOwnProperty("id")&&(c=f);return c},h=function(a){$("#"+a.id).addClass("fb-invalid")},i=function(){a.validationError=!1,$(".fb-invalid").removeClass("fb-invalid")}}}}])}.call(this),function(){angular.module("builder.directive").controller("ModelEditController",["$injector","$scope",function(a,b){var c=a.get("TagTypeResource"),d=a.get("MediaMetadataTypes");b.mediaDataTypes=a.get("MediaDataTypes"),b.status={},b.mediaDataIdentifiers=[],b.$watch("form.$error",function(a){a.hasOwnProperty("model.name.values.en")&&(b.status.nameRequired=!0)},!0),b.mediaTypeSelect=function(){switch(b.model.mediaMetadata.type.type){case"PROPERTY":b.mediaDataIdentifiers=d,b.required="[required]";break;case"TAG":c.allTagTypes().then(function(a){var c=a.plain();b.mediaDataIdentifiers=e(c.data),b.required="[required]"});break;default:b.mediaDataIdentifiers=[],b.required=""}};var e=function(a){var b=[];return angular.forEach(a,function(a){var c={name:a.name.values.en,value:a.identifier};b.push(c)}),b}}])}.call(this),function(){angular.module("builder.directive").factory("TagTypeResource",["$injector",function(a){var b=a.get("Restangular");return{allTagTypes:function(){var a=b.all("tagtype");return a.customPOST("{}","q")}}}])}.call(this),function(){angular.module("builder.directive").factory("FormResource",["$injector",function(a){var b=a.get("Restangular");return{postForm:function(a){var c=b.all("form");return c.post(a)}}}])}.call(this),function(){angular.module("builder.directive").constant("MediaMetadataTypes",[{name:"Creation date",value:"evtrs.metadata.creationdate"},{name:"Creation user",value:"evtrs.metadata.creationuser"},{name:"Modification date",value:"evtrs.metadata.modificationdate"},{name:"Modification user",value:"evtrs.metadata.modificationuser"}])}.call(this),function(){angular.module("builder.directive").constant("MediaDataTypes",[{type:"PROPERTY"},{type:"TAG"},{type:"STOCK"},{type:"COLLECTION"}])}.call(this),function(){angular.module("builder.directive").factory("ModelConverter",function(){function a(d,e){return angular.forEach(d,function(d){switch(d.component){case"formMediaDataField":e.push(d.model);break;case"formFileField":e.push(d.model);break;case"formFieldTabGroup":angular.forEach(d.webFormFieldTabs,function(c){var d=b(c,e);a(c.formFields,d)});break;case"formFieldGroup":var f=c(d,e);a(d.formFields,f);break;default:throw new Error("conversion error: invalid component "+d.component)}}),e}function b(a,b){var c={formFields:[],name:a.model.name,disabled:a.model.disabled,readOnly:a.model.readOnly,required:a.model.required,$type:"WebFormFieldTab"};return b.push(c),c.formFields}function c(a,b){var c={formFields:[],name:a.model.name,disabled:a.model.disabled,readOnly:a.model.readOnly,required:a.model.required,$type:"WebFormFieldGroup"};return b.push(c),c.formFields}return{convert:a}})}.call(this),function(){angular.module("builder.directive").factory("ModelValidator",["$injector",function(a){var b,c=a.get("$http"),d=a.get("$log");return c.get("/schema/validation-schema.json").success(function(a){b=a}).error(function(a,b){d.error(JSON.stringify(a)+" "+b)}),{validate:function(a){if(void 0===b)throw new Error("No validation schema loaded");return tv4.validateMultiple(a,b)}}}])}.call(this);